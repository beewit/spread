<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>工蜂小智 Admin index Examples</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="icon" type="image/png" href="../assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="工蜂小智"/>
    <link rel="stylesheet" href="/app/static/js/plugs/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../assets/css/amazeui.min.css"/>
    <link rel="stylesheet" href="../assets/css/admin.css">
    <link rel="stylesheet" href="../assets/css/app.css">
    <link rel="stylesheet" href="/app/static/css/base.css">
</head>

<body data-type="generalComponents">
<div class="tpl-page-container tpl-page-header-fixed">
    <div class="tpl-content-wrapper">
        <div class="tpl-portlet-components">
            <div class="portlet-title">
                <div class="caption font-green bold">
                    <span class="am-icon-user"></span> 平台帐号
                </div>
            </div>
            <div class="tpl-block">
                <ul class="am-nav am-nav-tabs">
                    <li class="am-active"><a data-href="list.html">平台帐号绑定</a></li>
                    <li><a data-href="member.html">我的帐号</a></li>
                    <li><a data-href="info.html">资料修改</a></li>
                    <li><a data-href="updatePwd.html">修改密码</a></li>
                </ul>
                <div class="am-g am-margin-top">
                    <div class="am-u-sm-12 am-u-md-6">
                        <div class="am-btn-toolbar">
                            <div class="am-btn-group am-btn-group-xs">
                                <button type="button" class="am-btn am-btn-default am-btn-success"
                                        data-layer="platform.html" data-layer-w="50%" data-layer-h="70%" data-layer-title="新增平台帐号">
                                    <span class="am-icon-plus"></span> 新增平台帐号
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="am-u-sm-12 am-u-md-3">
                        <div class="am-form-group">
                            <select data-am-selected="{btnSize: 'sm'}">
                                <option value="option1">所有平台</option>
                                <option value="option2">知乎</option>
                                <option value="option3">简书</option>
                                <option value="option3">新浪</option>
                                <option value="option3">微信</option>
                                <option value="option3">微博</option>
                                <option value="option3">头条</option>
                            </select>
                        </div>
                    </div>
                    <div class="am-u-sm-12 am-u-md-3">
                        <div class="am-input-group am-input-group-sm">
                            <input type="text" class="am-form-field">
                            <span class="am-input-group-btn">
                                <button class="am-btn  am-btn-default am-btn-success tpl-am-btn-success am-icon-search"
                                        type="button"></button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="am-g">
                    <div class="am-u-sm-12">
                        <form class="am-form">
                            <table class="am-table am-table-striped am-table-hover table-main table-img table-rang ">
                                <thead>
                                <tr>
                                    <th class="table-title">帐号</th>
                                    <th class="table-type">头像</th>
                                    <th class="table-title">昵称</th>
                                    <th class="table-author am-hide-sm-only">平台</th>
                                    <th class="table-date am-hide-sm-only">更新时间</th>
                                    <th class="table-set">操作</th>
                                </tr>
                                </thead>
                                <tbody id="view">
                                </tbody>
                            </table>
                            <div class="am-cf">
                                <div class="am-fr" id="page">
                                </div>
                            </div>
                            <hr>

                        </form>
                    </div>

                </div>
            </div>
            <div class="tpl-alert"></div>
        </div>
    </div>

</div>
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/amazeui.min.js"></script>
<script src="../assets/js/app.js"></script>
<script src="/app/static/js/plugs/layui/layui.all.js"></script>
<script src="../assets/js/common.ajax.js"></script>
<script src="../assets/js/common.js"></script>
<script id="list" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr>
        <td>{{ item.platform_account }}</td>
        <td>
            <a>
                <img src="{{ item.photo }}">
            </a>
        </td>
        <td>{{ item.nickname }}</td>
        <td>{{ item.platform }}</td>
        <td class="am-hide-sm-only">{{ item.ut_time }}</td>
        <td>
            <div class="am-btn-toolbar">
                <div class="am-btn-group am-btn-group-xs">
                    <button class="am-btn am-btn-default am-btn-xs am-text-success am-hide-sm-only" type="button"
                            onclick="bindUnion('{{ item.platform }}')">
                        <span class="am-icon-resistance"></span> 重新绑定
                    </button>
                </div>
            </div>
        </td>
    </tr>
    {{#  }); }}
    {{#  if(d == null){ }}
    无数据
    {{#  } }}
</script>
<script>
    var laytpl;
    var laypage;
    var pageIndex = 1;
    var getTpl = list.innerHTML, view = document.getElementById('view');
    layui.use(['laytpl', 'laypage'], function () {
        laytpl = layui.laytpl;
        laypage = layui.laypage;
        loadUnionList();
    });

    function loadUnionList() {
        $.ajax({
            url: "/platform/union/list",
            data: {pageIndex: pageIndex},
            success: function (d) {
                if (d.ret == 200) {
                    laytpl(getTpl).render(d.data.Data, function (html) {
                        view.innerHTML = html;
                    });
                    //总页数大于页码总数
                    laypage.render({
                        elem: 'page',
                        count: d.data.Count,
                        limit: d.data.PageSize,
                        curr: d.data.pageIndex,
                        jump: function (obj, first) {
                            if (!first) {
                                pageIndex = obj.curr
                                loadUnionList()
                            }
                        }
                    });
                }
            }
        });
    }

    function bindUnion(platform) {
        $.ajax({
            url: "/platform/bind",
            data: {type: platform},
            success: function (d) {
                player.msg(d.msg, {icon: 0, time: -1});
            }
        });
    }
</script>
</body>

</html>